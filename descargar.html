<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Descargar — Jesús María Conecta</title>
  <meta name="description" content="Descarga la app oficial. APK de Android y enlaces a tiendas." />
  <meta property="og:title" content="Descargar — Jesús María Conecta" />
  <meta property="og:description" content="Descarga la app oficial. APK de Android y enlaces a tiendas." />
  <meta property="og:type" content="website" />
  <meta name="theme-color" content="#0b3a75" />
  <style>
    :root{
      --primary:#0b3a75; /* azul institucional */
      --accent:#e91e63;  /* rosa institucional */
      --bg:#f6f8fb;
      --text:#1f2937;
      --muted:#6b7280;
      --card:#ffffff;
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,"Noto Sans","Helvetica Neue",sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.6;
    }
    .container{max-width:960px;margin:0 auto;padding:20px}
    header{
      background:linear-gradient(135deg,var(--primary),#173f8a 60%);
      color:#fff;
      padding:36px 0 28px;
    }
    header .logo{display:flex;align-items:center;gap:14px}
    header img{width:48px;height:48px;border-radius:12px;object-fit:cover}
    h1{margin:10px 0 6px;font-size:clamp(22px,4vw,32px)}
    p.lead{margin:0;color:#e5e7eb}

    .grid{display:grid;gap:18px;margin-top:-24px}
    @media(min-width:860px){.grid{grid-template-columns:1.3fr 1fr}}

    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:20px;
      box-shadow:0 10px 20px rgba(12,22,44,.06), 0 2px 8px rgba(12,22,44,.04);
    }

    .btn{display:inline-flex;align-items:center;gap:10px;
      padding:12px 16px;border-radius:14px;border:none;cursor:pointer;
      font-weight:600;text-decoration:none;transition:transform .06s ease,opacity .15s ease}
    .btn:active{transform:scale(.98)}
    .btn-primary{background:var(--primary);color:#fff}
    .btn-accent{background:var(--accent);color:#fff}
    .btn-ghost{background:#eef2ff;color:#172554}
    .btn[disabled]{opacity:.6;cursor:not-allowed}

    .row{display:flex;flex-wrap:wrap;gap:12px}
    .muted{color:var(--muted);font-size:14px}
    .tag{display:inline-block;background:#eef2ff;color:#172554;padding:4px 10px;border-radius:999px;font-size:12px}
    .sep{height:1px;background:#e5e7eb;margin:16px 0}

    .qr-wrap{display:grid;place-items:center;background:#fff;border-radius:16px;border:1px solid #e5e7eb;padding:12px}
    .qr-wrap img{width:180px;height:180px;image-rendering:pixelated}

    .small{font-size:12px}
    code{background:#f3f4f6;padding:2px 6px;border-radius:8px}

    footer{padding:28px 0;color:#6b7280;text-align:center}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="logo">
        <!-- Reemplaza por tu logo si quieres -->
        <img src="https://raw.githubusercontent.com/github/explore/main/topics/github-pages/github-pages.png" alt="Logo" />
        <div>
          <h1>Descarga la aplicación</h1>
          <p class="lead">Android (APK desde GitHub) y enlaces oficiales a tiendas</p>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="grid">

      <!-- Columna principal: acciones de descarga -->
      <section class="card">
        <h2 style="margin-top:0">Android</h2>
        <p class="muted" id="apk-status">Buscando el último APK público en las Releases…</p>

        <div class="row" style="margin-top:8px">
          <a id="btn-apk" class="btn btn-primary" href="#" download disabled>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3v10m0 0 4-4m-4 4-4-4M5 21h14" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <span>Descargar APK</span>
          </a>
          <a id="btn-play" class="btn btn-ghost" href="#" target="_blank" rel="noopener">Play Store</a>
        </div>

        <div class="sep"></div>
        <div class="row">
          <span class="tag" id="apk-version">v–</span>
          <span class="muted" id="apk-size">—</span>
        </div>
        <p class="muted" id="apk-notes" style="margin-top:8px"></p>

        <div class="sep"></div>
        <details>
          <summary>Instalar por ADB (avanzado)</summary>
          <p class="small">Conecta tu dispositivo y ejecuta:</p>
          <pre><code id="adb-code">adb install MiApp.apk</code></pre>
        </details>
      </section>

      <!-- Columna secundaria: QR + iOS -->
      <aside class="card">
        <h3 style="margin-top:0">Descarga con código QR</h3>
        <div class="qr-wrap">
          <img id="qr" alt="QR de descarga" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Crect width='100%25' height='100%25' fill='%23f3f4f6'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%236b7280' font-family='monospace' font-size='12'%3Eesperando URL%3C/text%3E%3C/svg%3E" />
        </div>
        <p class="small muted" id="qr-caption" style="text-align:center;margin-top:8px">Se generará cuando exista el enlace del APK.</p>

        <div class="sep"></div>
        <h3>iOS</h3>
        <p class="muted">Instala desde App Store:</p>
        <a id="btn-ios" class="btn btn-accent" href="#" target="_blank" rel="noopener">Abrir en App Store</a>
      </aside>

    </div>
  </main>

  <footer>
    <div class="container">
      <p class="small">© <span id="year"></span> Municipio de Jesús María. Todos los derechos reservados.</p>
    </div>
  </footer>

<script>
  // === CONFIGURA AQUÍ ===
  const OWNER = "OWNER";               // ← tu usuario u organización (ej. "KevinTorres")
  const REPO  = "REPO";                // ← nombre del repositorio (ej. "jesus-maria-conecta")
  const PLAY_STORE_URL = "https://play.google.com/store/apps/details?id=com.tu.paquete"; // opcional
  const APP_STORE_URL  = "https://apps.apple.com/app/id6752533172";                      // opcional
  // Si quieres forzar un APK específico si no hay releases o el repo es privado:
  // Copia el link de tu release: https://github.com/OWNER/REPO/releases/download/vX.Y.Z/TuApp.apk
  const FALLBACK_APK_URL = ""; 
  // === FIN CONFIG ===

  const $ = (id)=>document.getElementById(id);
  $("year").textContent = new Date().getFullYear();
  if (PLAY_STORE_URL && PLAY_STORE_URL !== "#") $("btn-play").href = PLAY_STORE_URL; else $("btn-play").style.display='none';
  if (APP_STORE_URL && APP_STORE_URL !== "#") $("btn-ios").href = APP_STORE_URL; else $("btn-ios").style.display='none';

  async function findLatestApk() {
    if (!OWNER || !REPO || OWNER === "OWNER") {
      $("apk-status").textContent = "Configura OWNER y REPO en el código";
      return;
    }
    const api = `https://api.github.com/repos/${OWNER}/${REPO}/releases/latest`;
    try {
      const res = await fetch(api, { headers: { 'Accept': 'application/vnd.github+json' } });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();
      const assets = (data.assets||[]).filter(a=>/\.apk$/i.test(a.name));
      if (!assets.length) throw new Error('No hay assets .apk en la última release');
      const apk = assets[0];

      const url = apk.browser_download_url;
      const sizeMB = (apk.size/1024/1024).toFixed(2);

      // Actualiza UI
      $("btn-apk").href = url;
      $("btn-apk").download = apk.name;
      $("btn-apk").removeAttribute('disabled');
      $("apk-status").textContent = "APK listo para descargar.";
      $("apk-version").textContent = data.tag_name ? data.tag_name : 'Última versión';
      $("apk-size").textContent = `${sizeMB} MB`;
      $("adb-code").textContent = `adb install ${apk.name}`;

      // Notas (primeros 200 chars)
      const notes = (data.body||'').replace(/\r/g,'').trim();
      $("apk-notes").textContent = notes ? notes.slice(0,200)+(notes.length>200?'…':'') : '';

      // QR sin anuncios
      const qrURL = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(url)}`;
      $("qr").src = qrURL;
      $("qr-caption").textContent = apk.name;

    } catch (err) {
      console.warn(err);
      if (FALLBACK_APK_URL) {
        $("btn-apk").href = FALLBACK_APK_URL;
        $("btn-apk").removeAttribute('disabled');
        $("apk-status").textContent = "Usando enlace alternativo (fallback).";
        const qrURL = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(FALLBACK_APK_URL)}`;
        $("qr").src = qrURL;
        $("qr-caption").textContent = 'Enlace alternativo';
      } else {
        $("apk-status").textContent = "No se pudo obtener el APK. Verifica que la Release sea pública y contenga un .apk.";
      }
    }
  }

  findLatestApk();
</script>
</body>
</html>

